---
import Layout from "../../layouts/Layout.astro";
import Card from "../../components/Card.astro";
import { supabase } from "../../lib/supabase";

// Supabaseì—ì„œ ëª¨ë“  ê²Œì‹œë¬¼ì„ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
async function fetchPosts() {
  const { data, error } = await supabase
      .from('posts')
      .select('*')
      .order('id', { ascending: false });

  if (error) {
    console.error('Error fetching posts:', error);
    return [];
  }

  return data;
}

// í˜ì´ì§€ì—ì„œ Supabase í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì—¬ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜´
const posts = await fetchPosts();
---


<Layout title="ëª¨ë“  ê²Œì‹œë¬¼" description="ëª¨ë“  ê²Œì‹œë¬¼">
  <div class="flex justify-between items-center mb-4">
    <h1 class="text-3xl font-bold">ëª¨ë“  ê²Œì‹œë¬¼</h1>
    <a href="/bbs/new-post" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 focus:outline-none">
      ìƒˆë¡œìš´ ê²Œì‹œë¬¼ ë§Œë“¤ê¸°
    </a>
  </div>
  <ul class="space-y-4">
    {posts.map((post: { id: string; title: string; content: string; like_count: number; dislike_count: number; }) => (
        <li>
          <Card href={`/bbs/${post.id}`} title={post.title} body={post.content} />
          <div class="flex space-x-4">
            <span>ğŸ‘ {post.like_count}</span>
            <span>ğŸ‘ {post.dislike_count}</span>
          </div>
        </li>
    ))}
  </ul>
</Layout>
